<h2>{% if expense %}Edit{% else %}Create{% endif %} Expense</h2>
<form method="post">
  {% csrf_token %}
  <input name="title" placeholder="Title" value="{{ expense.title|default:'' }}"><br>
  <input name="amount" type="number" step="0.01" value="{{ expense.amount|default:'' }}"><br>
  <input name="date" type="date" value="{{ expense.date|default:'' }}"><br>
  <textarea name="notes">{{ expense.notes|default:'' }}</textarea><br>

  <select name="category" id="category-select" onchange="toggleNewCategoryInput()">
    <option value="">--Select Category--</option>
    {% for cat in categories %}
      <option value="{{ cat.id }}" {% if expense and expense.category.id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
    {% endfor %}
    <option value="__new__">+ Add New Category</option>
  </select><br>

  <input type="text" name="new_category" id="new-category-input" placeholder="New Category Name" style="display:none;"><br>

  <button type="submit">Save</button>
</form>

<script>
  function toggleNewCategoryInput() {
    const select = document.getElementById('category-select');
    const newCatInput = document.getElementById('new-category-input');
    if (select.value === '__new__') {
      newCatInput.style.display = 'inline';
    } else {
      newCatInput.style.display = 'none';
      newCatInput.value = '';
    }
  }
</script>
